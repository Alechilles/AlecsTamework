{
  "Type": "Component",
  "Class": "Instruction",
  "DefaultState": ".Night",
  "Parameters": {
    "_ImportStates": [
      "OnDamageWithTarget",
      "OnDamageNoTarget",
      "OnProximity",
      "OnWakeUp",
      "OnFlockAttack"
    ],
    "DayTimePeriod": {
      "Value": [
        6.01,
        17.99
      ],
      "Description": "The hour range considered to be daytime for this NPC."
    },
    "DayTimeNapWeight": {
      "Value": 2,
      "Description": "Weight used to determine if the NPC should have a short nap during the day. Set to 0 to disable."
    },
    "DayTimeNapTimeRange": {
      "Value": [
        10,
        30
      ],
      "Description": "How long a daytime nap should last."
    },
    "HearingRange": {
      "Value": 8,
      "Description": "Hearing range while sleeping."
    },
    "Attitudes": {
      "Value": [
        "Hostile",
        "Neutral"
      ],
      "Description": "A prioritised list of attitudes to respond to while sleeping."
    },
    "FlockArray": {
      "Value": [],
      "TypeHint": "String",
      "Description": "NPCGroup array for flock behavior (used for Flock_Attack wakeups)."
    }
  },
  "Content": {
    "$Comment": "Sleep State: Handles naps, night sleep, and wake-up behavior.",
    "Instructions": [
      {
        "$Comment": "Initialize sleep mode (nap vs night) on entry.",
        "Sensor": {
          "Type": "Any",
          "Once": true
        },
        "Instructions": [
          {
            "$Comment": "If it's daytime and naps are enabled, treat this as a nap.",
            "Enabled": {
              "Compute": "DayTimeNapWeight > 0"
            },
            "Sensor": {
              "Type": "Time",
              "Period": {
                "Compute": "DayTimePeriod"
              },
              "CheckDay": true
            },
            "Actions": [
              {
                "Type": "State",
                "State": ".Nap"
              }
            ]
          },
          {
            "$Comment": "Otherwise, treat this as night sleep.",
            "Sensor": {
              "Type": "Not",
              "Sensor": {
                "Type": "Time",
                "Period": {
                  "Compute": "DayTimePeriod"
                },
                "CheckDay": true
              }
            },
            "Actions": [
              {
                "Type": "State",
                "State": ".Night"
              }
            ]
          }
        ]
      },
      {
        "$Comment": "Wake up if an enemy attacks a flock member.",
        "Enabled": {
          "Compute": "!isEmptyStringArray(FlockArray)"
        },
        "Sensor": {
          "Type": "Beacon",
          "Message": "Flock_Attack",
          "TargetSlot": "LockedTarget"
        },
        "Actions": [
          {
            "Type": "ParentState",
            "State": "OnFlockAttack"
          }
        ]
      },
      {
        "$Comment": "Daytime nap behavior.",
        "Sensor": {
          "Type": "State",
          "State": ".Nap"
        },
        "Instructions": [
          {
            "Reference": "Component_Tamework_Instruction_Sleep_Nap",
            "Modify": {
              "DayTimeNapTimeRange": {
                "Compute": "DayTimeNapTimeRange"
              }
            }
          },
          {
            "Reference": "Component_Instruction_Wild_Sleep_State",
            "Modify": {
              "_ExportStates": [
                "OnDamageWithTarget",
                "OnDamageNoTarget",
                "OnProximity",
                "OnWakeUp"
              ],
              "HearingRange": {
                "Compute": "HearingRange"
              },
              "Attitudes": {
                "Compute": "Attitudes"
              },
              "WakeupSensor": "Component_Sensor_Timed_Nap"
            }
          }
        ]
      },
      {
        "$Comment": "Night-time sleep behavior.",
        "Sensor": {
          "Type": "State",
          "State": ".Night"
        },
        "Instructions": [
          {
            "Reference": "Component_Instruction_Wild_Sleep_State",
            "Modify": {
              "_ExportStates": [
                "OnDamageWithTarget",
                "OnDamageNoTarget",
                "OnProximity",
                "OnWakeUp"
              ],
              "HearingRange": {
                "Compute": "HearingRange"
              },
              "Attitudes": {
                "Compute": "Attitudes"
              },
              "DayTimePeriod": {
                "Compute": "DayTimePeriod"
              }
            }
          }
        ]
      }
    ]
  }
}

